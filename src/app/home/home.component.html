<md-sidenav-layout fullscreen>
  <md-sidenav #sidenav>
    <md-nav-list>
      <a md-list-item (click)="logout()">
        <md-icon md-list-icon>input</md-icon>
        <span md-line>Logout</span>
      </a>
    </md-nav-list>
  </md-sidenav>
  <md-toolbar color="primary">
    <button md-icon-button (click)="sidenav.open()">
      <svg style="width:24px;height:24px" viewBox="0 0 24 24">
        <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
      </svg>
    </button>
    Sandwich Club 2
  </md-toolbar>

  <div class="content">
    <md-card>
      <md-card-header *ngIf="me | async">
        <img md-card-avatar [src]="(me | async)?.data.me.avatarUrl">
        <md-card-title>{{(me | async)?.data.me.firstName}} {{(me | async)?.data.me.lastName}}</md-card-title>
        <md-card-subtitle>Header subtitle</md-card-subtitle>
      </md-card-header>
      <md-card-content>
        You owe: {{ unpaidAmount | async | currency:'NZD':true }}
      </md-card-content>
      <md-card-actions align="end">
      <!-- Removing until we get it wired up to the backend.
           Note: This button should mark all weeks paid EXCEPT the current week.
                 Else people will likely prematurely pay for the current week before everyone has joined -->
<!--         <button md-button (click)="payAll()">PAY ALL</button> -->
      </md-card-actions>
    </md-card>

    <md-card *ngIf="week">
      <md-card-header>
        <md-card-title>Week Details -
          <span *ngIf="currentWeekId === weekId">
            this week
          </span>
          <span *ngIf="currentWeekId > weekId">
            {{currentWeekId - weekId}} week(s) ago
          </span>
          <span *ngIf="currentWeekId === weekId - 1">
            next week
          </span>
          <span *ngIf="currentWeekId === weekId - 2">
            week after next
          </span>
          <span *ngIf="currentWeekId < weekId - 2">
            WTF are you doing? this is the future!!
          </span> -
          {{ weekService.getStartOfWeek(weekService.weekIdToDate(weekId)) | date:'dd/MM/yy' }}
        </md-card-title>
      </md-card-header>
      <md-card-content>
        <span>Cost: {{ week?.cost | currency:'NZD':true }}</span> <br>
        <span *ngIf="thisWeekSub?.slices === 1">Your share: {{ week?.cost / week?.users.length | currency:'NZD':true }} - Paid: {{ thisWeekSub?.paid | currency:'NZD':true }}</span> <br>
        <span
          *ngIf="week?.shopper">Shopper: {{ week?.shopper?.firstName }}</span>
        <span *ngIf="!week?.shopper">No shopper set</span>
      </md-card-content>
      <md-card-actions align="end">
        <button md-button (click)="lastWeek()">PREVIOUS WEEK</button>
        <button md-button (click)="nextWeek()">NEXT WEEK</button>
        <button md-button (click)="subToWeek()" *ngIf="thisWeekSub == null || thisWeekSub?.slices === 0">JOIN</button>
        <button md-button (click)="unsubToWeek()" *ngIf="thisWeekSub?.slices === 1">LEAVE</button>
        <button md-button (click)="payWeek()" *ngIf="!thisWeekSub?.paid">PAY</button>
        <button md-button (click)="unpayWeek()" *ngIf="thisWeekSub?.paid > 0">UN-PAY</button>
      </md-card-actions>
    </md-card>

    <h2>People in Week</h2>

    <md-list class="weeksUsers">
      <md-list-item class="weeksUsers-user" *ngFor=" let user of week?.users">
        <img md-list-avatar [src]="user.user.avatarUrl">
        <p md-line>
          {{user.user.firstName}} {{user.user.lastName}}
        </p>
      </md-list-item>
    </md-list>

    <h2>Lars Area</h2>

    <form (submit)="updateCost()">
      <md-input-container>
        <input type="number" name="cost" md-input [(ngModel)]="cost" placeholder="Groceries Cost" step="0.01">
        <span md-prefix>$&nbsp;</span>
      </md-input-container>

      <button md-raised-button type="submit">Update Cost</button>
    </form>

    <!--<button (click)="refetch()">Refetch</button>

    {{thisWeekSub | json}}-->
  </div>
</md-sidenav-layout>
